let svgElm,aActions,iStartWidth=0,bToggle=!0,bLocal=!0;const hName=document.getElementById("hidden-name"),hTrigger=document.getElementById("hidden-name"),hActions=document.getElementById("hidden-actions"),startClear=document.getElementById("load");startClear.addEventListener("click",(function(){load()})),startClear.click();const elmZoom=document.getElementById("target-zoom"),elmIn=document.getElementById("target-zoomIn"),elmOut=document.getElementById("target-zoomOut"),elmReset=document.getElementById("target-reset"),elmKeyIcon=document.getElementById("target-keyIcon"),elmKey=document.getElementById("target-key"),elmDetail=document.getElementById("target-detail"),elmDownloadPNG=document.getElementById("target-downloadPNG"),elmDownloadSVG=document.getElementById("target-downloadSVG"),elmModal=document.getElementById("myModal"),elmSpan=document.getElementsByClassName("close")[0],downloadElem=document.getElementById("download");function ShowKey(){elmDetail.style="display:none",elmKey.style="width:100%; display:block;",elmModal.style="display:block"}function toggleZoom(){bToggle?(elmIn.style="position:fixed; left:150px; top:30px; font-size:20px;",elmOut.style="position:fixed; left:225px; top:30px; font-size:20px;",elmZoom.style="display:none",iWidth=iStartWidth,svgElm.setAttribute("width",iWidth+"%"),bToggle=!1):(elmZoom.style="",elmReset.style="position:fixed; left:300px; top:30px; display:none;",elmIn.style="position:fixed; left:150px; top:30px; font-size:20px; display:none;",elmOut.style="position:fixed; left:225px; top:30px; font-size:20px; display:none",iWidth=iStartWidth,svgElm.setAttribute("width",iWidth+"%"),bToggle=!0)}function Zoom(){let e=svgElm.getAttribute("width"),t=parseInt(e.substring(0,e.length-1)),n=parseInt(elmZoom.value);t=iStartWidth+10*n,t<0&&(t=0),svgElm.setAttribute("width",t+"%")}function ZoomIn(){let e=svgElm.getAttribute("width"),t=parseInt(e.substring(0,e.length-1));t+=10,svgElm.setAttribute("width",t+"%"),elmReset.style="position:fixed; left:300px; top:30px;"}function ZoomOut(){let e=svgElm.getAttribute("width"),t=parseInt(e.substring(0,e.length-1));t-=10,svgElm.setAttribute("width",t+"%"),elmReset.style="position:fixed; left:300px; top:30px;;"}function ZoomReset(){svgElm.setAttribute("width","100%"),elmReset.style="position:fixed; left:300px; top:30px; display:none;"}function load(){let e;const t=document.getElementById("target-flowName"),n=document.getElementById("target-id"),o=document.getElementById("modalData");if(e=sessionStorage.getItem("diagram"),null!=e&&null!=e){t.innerHTML=sessionStorage.getItem("name"),n.innerHTML=sessionStorage.getItem("id");const l=nomnoml.renderSvg(e);document.getElementById("target-svgDom").innerHTML=l,svgElm=document.getElementsByTagName("svg")[0],svgElm.setAttribute("width","100%"),svgElm.setAttribute("height","100%");let i=svgElm.getAttribute("width");iStartWidth=parseInt(i.substring(0,i.length-1)),aActions=JSON.parse(sessionStorage.getItem("actions")),o.innerHTML=sessionStorage.getItem("actions")}else{bLocal=!1,svgElm=document.getElementsByTagName("svg")[0];let e=svgElm.getAttribute("width");iStartWidth=parseInt(e.substring(0,e.length-1)),aActions=JSON.parse(o.innerHTML)}}function downloadSVGAsText(){const e=document.querySelector("svg"),t=btoa(unescape(encodeURIComponent(e.outerHTML))),n=document.createElement("a"),o=new MouseEvent("click"),l=document.getElementById("target-flowName").innerHTML;n.download=l+".svg",n.href="data:image/svg+xml;base64,"+t,n.dispatchEvent(o)}function downloadSVGAsPNG(e){const t=document.createElement("canvas"),n=document.querySelector("svg"),o=btoa(unescape(encodeURIComponent(n.outerHTML))),l=parseInt(n.getAttribute("width")),i=parseInt(n.getAttribute("height")),d=document.createElement("img");d.src="data:image/svg+xml;base64,"+o,d.onload=function(){t.setAttribute("width",l),t.setAttribute("height",i);t.getContext("2d").drawImage(d,0,0,l,i);const n=t.toDataURL("image/png");if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t.msToBlob(),hName.innerText+".png"),e.preventDefault();else{const e=document.createElement("a"),t=new MouseEvent("click");e.download=hName.innerText+".png",e.href=n,e.dispatchEvent(t)}}}function downloadHTML(){let e=document.querySelector("html").innerHTML;const t=document.getElementById("target-flowName").innerHTML;e='<!doctype html><html lang="en">'+e+"</html>",e=e.replace('<div class="mui--text-white mui--text-body2" style="font-size:10px" id="download">Download</div>',""),e=e.replaceAll(' src="assets/js/diagramLoad.min.js">',">"+sJS),e=e.replaceAll('<script src="node_modules/nomnoml/dist/nomnoml.js"><\/script>',""),e=e.replaceAll(' <script src="node_modules/graphre/dist/graphre.js"><\/script>',"");const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t+" Diagram.html"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}elmDownloadPNG.addEventListener("click",downloadSVGAsText),elmDownloadSVG.addEventListener("click",downloadSVGAsText),elmZoom.addEventListener("input",Zoom),elmIn.addEventListener("click",ZoomIn),elmOut.addEventListener("click",ZoomOut),elmReset.addEventListener("click",ZoomReset),elmKeyIcon.addEventListener("click",ShowKey),elmSpan.onclick=function(){elmModal.style.display="none"},document.getElementById("target-logo").addEventListener("click",toggleZoom),window.onclick=function(e){e.target==elmModal&&(elmModal.style.display="none")},document.querySelector("svg").onclick=function(e){const t=e.target.attributes["data-name"].value,n=JSON.parse(hTrigger.innerText),o="Join/Table/ParseJson/Select/Query/Compose";let l,i,d,s;if(s=bLocal?"assets/img/":"https://wyattdave.github.io/Auto-Review/assets/img/","*"!=t.substring(0,1)){let e=aActions.find((e=>e.name.replace(/[":\[|{}()\]]+/g,"")==t));l="<b>Name:</b> "+e.name+"<br><b>ID:</b> "+e.id+"<br><b>Type:</b> "+e.type+"<br><b>Step: </b>"+e.step+"<br><b>Index:</b> "+e.index+"<br><b>Detail:</b> "+e.detail,i="<b>Tier: </b>"+e.tier+"<br><b>Filter:</b> "+e.filter+"<br><b>Pagination:</b> "+e.pagination+"<br><b>Secure: </b>"+e.secure+"<br><b>Retry:</b> "+e.retry+"<br><b>Timeout: </b>"+e.timeout,d="<b>Notes</b><br>"+e.notes,null==e.imgURL&&(o.includes(e.type)||e.type.includes("Variable"))?document.getElementById("target-image").src=s+"internIcon.png":null!=e.imgURL||o.includes(e.type)?document.getElementById("target-image").src=e.imgURL:document.getElementById("target-image").src=s+"autoreview icon 300 v2.png"}else l="<b>Trigger: </b>"+n.trigger+"<br><b>Parameters: </b>"+n.triggerParam+"<br><b>Configs: </b>"+n.triggerConfig,i="<br><b>Expression: </b>"+n.triggerExpress+"<br><b>Inputs: </b>"+n.triggerInputs+"<br><b>Recurrence: </b>"+n.triggerRecur,document.getElementById("target-image").src="assets/img/autoreview icon 300 v2.png";document.getElementById("target-modal").innerHTML=l,document.getElementById("target-modal2").innerHTML=i,d.length>17?document.getElementById("target-modal3").innerHTML=d:document.getElementById("target-modal3").innerHTML="",elmKey.style="display:none",elmDetail.style="display:block",elmModal.style="display:block"},downloadElem.addEventListener("click",(function(){downloadHTML()})),hName.innerText=sessionStorage.getItem("name"),hTrigger.innerText=sessionStorage.getItem("trigger"),hActions.innerText=sessionStorage.getItem("actions");const sJS='let svgElm=document.getElementsByTagName("svg")[0],iStartWidth=0,bToggle=!0,bLocal=!0;const hName=document.getElementById("hidden-name"),hTrigger=document.getElementById("hidden-name"),hActions=document.getElementById("hidden-actions"),elmZoom=document.getElementById("target-zoom"),elmIn=document.getElementById("target-zoomIn"),elmOut=document.getElementById("target-zoomOut"),elmReset=document.getElementById("target-reset"),elmKeyIcon=document.getElementById("target-keyIcon"),elmKey=document.getElementById("target-key"),elmDetail=document.getElementById("target-detail"),elmDownloadPNG=document.getElementById("target-downloadPNG"),elmDownloadSVG=document.getElementById("target-downloadSVG"),elmModal=document.getElementById("myModal"),elmSpan=document.getElementsByClassName("close")[0],downloadElem=document.getElementById("download");let aActions=JSON.parse(hActions.innerText);function ShowKey(){elmDetail.style="display:none",elmKey.style="width:100%; display:block;",elmModal.style="display:block"}function toggleZoom(){bToggle?(elmIn.style="position:fixed; left:150px; top:30px; font-size:20px;",elmOut.style="position:fixed; left:225px; top:30px; font-size:20px;",elmZoom.style="display:none",iWidth=iStartWidth,svgElm.setAttribute("width",iWidth+"%"),bToggle=!1):(elmZoom.style="",elmReset.style="position:fixed; left:300px; top:30px; display:none;",elmIn.style="position:fixed; left:150px; top:30px; font-size:20px; display:none;",elmOut.style="position:fixed; left:225px; top:30px; font-size:20px; display:none",iWidth=iStartWidth,svgElm.setAttribute("width",iWidth+"%"),bToggle=!0)}function Zoom(){let e=svgElm.getAttribute("width"),t=parseInt(e.substring(0,e.length-1)),n=parseInt(elmZoom.value);t=iStartWidth+10*n,t<0&&(t=0),svgElm.setAttribute("width",t+"%")}function ZoomIn(){let e=svgElm.getAttribute("width"),t=parseInt(e.substring(0,e.length-1));t+=10,svgElm.setAttribute("width",t+"%"),elmReset.style="position:fixed; left:300px; top:30px;"}function ZoomOut(){let e=svgElm.getAttribute("width"),t=parseInt(e.substring(0,e.length-1));t-=10,svgElm.setAttribute("width",t+"%"),elmReset.style="position:fixed; left:300px; top:30px;;"}function ZoomReset(){svgElm.setAttribute("width","100%"),elmReset.style="position:fixed; left:300px; top:30px; display:none;"}function downloadSVGAsText(){const e=document.querySelector("svg"),t=btoa(unescape(encodeURIComponent(e.outerHTML))),n=document.createElement("a"),o=new MouseEvent("click");n.download=hName.innerText+".svg",n.href="data:image/svg+xml;base64,"+t,n.dispatchEvent(o)}function downloadSVGAsPNG(e){const t=document.createElement("canvas"),n=document.querySelector("svg"),o=btoa(unescape(encodeURIComponent(n.outerHTML))),l=parseInt(n.getAttribute("width")),i=parseInt(n.getAttribute("height")),d=document.createElement("img");d.src="data:image/svg+xml;base64,"+o,d.onload=function(){t.setAttribute("width",l),t.setAttribute("height",i);t.getContext("2d").drawImage(d,0,0,l,i);const n=t.toDataURL("image/png");if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t.msToBlob(),hName.innerText+".png"),e.preventDefault();else{const e=document.createElement("a"),t=new MouseEvent("click");e.download=hName.innerText+".png",e.href=n,e.dispatchEvent(t)}}}elmDownloadPNG.addEventListener("click",downloadSVGAsText),elmDownloadSVG.addEventListener("click",downloadSVGAsText),elmZoom.addEventListener("input",Zoom),elmIn.addEventListener("click",ZoomIn),elmOut.addEventListener("click",ZoomOut),elmReset.addEventListener("click",ZoomReset),elmKeyIcon.addEventListener("click",ShowKey),elmSpan.onclick=function(){elmModal.style.display="none"},document.getElementById("target-logo").addEventListener("click",toggleZoom),window.onclick=function(e){e.target==elmModal&&(elmModal.style.display="none")},document.querySelector("svg").onclick=function(e){const t=e.target.attributes["data-name"].value,n=JSON.parse(hTrigger.innerText),o="Join/Table/ParseJson/Select/Query/Compose";let l,i,d,m;if(m=bLocal?"assets/img/":"https://wyattdave.github.io/Auto-Review/assets/img/","*"!=t.substring(0,1)){let e=aActions.find((e=>e.name.replace(/[":[|{}()]]+/g,"")==t));l="<b>Name:</b> "+e.name+"<br><b>ID:</b> "+e.id+"<br><b>Type:</b> "+e.type+"<br><b>Step: </b>"+e.step+"<br><b>Index:</b> "+e.index+"<br><b>Detail:</b> "+e.detail,i="<b>Tier: </b>"+e.tier+"<br><b>Filter:</b> "+e.filter+"<br><b>Pagination:</b> "+e.pagination+"<br><b>Secure: </b>"+e.secure+"<br><b>Retry:</b> "+e.retry+"<br><b>Timeout: </b>"+e.timeout,d="<b>Notes</b><br>"+e.notes,null==e.imgURL&&(o.includes(e.type)||e.type.includes("Variable"))?document.getElementById("target-image").src=m+"internIcon.png":null!=e.imgURL||o.includes(e.type)?document.getElementById("target-image").src=e.imgURL:document.getElementById("target-image").src=m+"autoreview icon 300 v2.png"}else l="<b>Trigger: </b>"+n.trigger+"<br><b>Parameters: </b>"+n.triggerParam+"<br><b>Configs: </b>"+n.triggerConfig,i="<br><b>Expression: </b>"+n.triggerExpress+"<br><b>Inputs: </b>"+n.triggerInputs+"<br><b>Recurrence: </b>"+n.triggerRecur,document.getElementById("target-image").src="assets/img/autoreview icon 300 v2.png";document.getElementById("target-modal").innerHTML=l,document.getElementById("target-modal2").innerHTML=i,d.length>17?document.getElementById("target-modal3").innerHTML=d:document.getElementById("target-modal3").innerHTML="",elmKey.style="display:none",elmDetail.style="display:block",elmModal.style="display:block"};';

